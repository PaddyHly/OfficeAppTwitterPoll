<!DOCTYPE html>
<html>
<head>
    <style>
        .chart div {
      font: 10px sans-serif;
      background-color: steelblue;
      text-align: right;
      padding: 3px;
      margin: 1px;
      color: white;
    }
    </style>
    <title>#PowerPoll</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

    <script src="../../Scripts/jquery-1.9.1.js" type="text/javascript"></script>

    <link href="../../Content/Office.css" rel="stylesheet" type="text/css" />
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.2.5.min.js"></script>
    <script src="/wp-includes/js/addInput.js" language="Javascript" type="text/javascript"></script>



    <!-- To enable offline debugging using a local reference to Office.js, use:                        -->
    <!-- <script src="../../Scripts/Office/MicrosoftAjax.js" type="text/javascript"></script>  -->
    <!-- <script src="../../Scripts/Office/1.1/office.js" type="text/javascript"></script>  -->

    <link href="../App.css" rel="stylesheet" type="text/css" />
    <script src="../App.js" type="text/javascript"></script>

    <link href="Bar.css" rel="stylesheet" type="text/css" />
    <script src="Bar.js" type="text/javascript"></script>
    <script>
            var client = new WindowsAzure.MobileServiceClient(
                "https://powerpoll.azure-mobile.net/",
                "zKZEZggVbgQIpzwZuJTtVmHNYRJZtx79"
            );
    </script>
    <script>
    function getQueryParams(qs) {
        qs = qs.split("+").join(" ");

        var params = {}, tokens,
            re = /[?&]?([^=]+)=([^&]*)/g;

        while (tokens = re.exec(qs)) {
            params[decodeURIComponent(tokens[1])]
                = decodeURIComponent(tokens[2]);
        }
        return params;
    }
    </script>
</head>
<!--************************************************************************************************************************************-->
<body>
    <div class="chart"></div>
    <script src="https://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.2.5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
    <script>

        var x = d3.scale.linear()
            .domain([0, 100])
            .range([0, 420]);
        
        var args = getQueryParams(document.location.search);

        client.getTable('Result').where({ pollId: args.hash }).read().done(function (data) {
            d3.select(".chart")
              .selectAll("div")
                .data(data)
              .enter().append("div")
                .style("width", function (d) { return x(d.count) + "px"; })
                .text(function (d) { return d.count; });
        });
        var end_time = new Date();
        end_time.setMinutes(end_time.getMinutes() + args.duration);
        update(args.hash);

        function update(hash) {
            client.getTable('Result').where({ pollId: args.hash }).read().done(function (data) {
                d3.select(".chart")
                    .selectAll("div")
                    .data(data)
                    .transition()
                    .style("width", function (d) { return x(d.count) + "px"; })
                    .text(function (d) { return d.count; });
            });
            window.setTimeout(function () { update(hash); }, 1000);
        }

    </script>

</body>
</html>

