<!DOCTYPE html>
<html>
<head>
    <title>#PowerPoll</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        
    <script src="../../Scripts/jquery-1.9.1.js" type="text/javascript"></script>

    <link href="../../Content/Office.css" rel="stylesheet" type="text/css" />
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.2.5.min.js"></script>
    <script src="/wp-includes/js/addInput.js" language="Javascript" type="text/javascript"></script>
   
        

        <!-- To enable offline debugging using a local reference to Office.js, use:                        -->
        <!-- <script src="../../Scripts/Office/MicrosoftAjax.js" type="text/javascript"></script>  -->
        <!-- <script src="../../Scripts/Office/1.1/office.js" type="text/javascript"></script>  -->

        <link href="../App.css" rel="stylesheet" type="text/css" />
        <script src="../App.js" type="text/javascript"></script>

        <link href="Home.css" rel="stylesheet" type="text/css" />
        <script src="Home.js" type="text/javascript"></script>
        <script>
            var client = new WindowsAzure.MobileServiceClient(
                "https://powerpoll.azure-mobile.net/",
                "zKZEZggVbgQIpzwZuJTtVmHNYRJZtx79"
            );
        </script>
</head>
<body>
    <div id="header">
        <h1>#PowerPoll</h1>
    </div>
    <div id="keyData">
        <key>Poll Hashtag: #</key>
        <input type="text" placeholder="PollName" id="hashtag" />
        <br>
        <length>Duration: <input type="number" min="1" max="30" id="length" />(mins)</length>
    </div>
    <div id="graphSelect">
        <graph>Graph Style</graph>
        <select>
            <option value="bar">Bar Graph</option>
            <option value="pie">Pie Chart</option>
        </select>
    </div>
    <div id="keywords">
        <br>Keyword 1:  <input type="text" placeholder="Enter Keyword" id="key1" name="keyword"/>
        <br>Keyword 2:  <input type="text" placeholder="Enter Keyword" id="key2" name="keyword"/>
    </div>
    <input type="button" id="addKeyword" value="+ Keyword" />
    <br><input type="button" id="createPoll" value="Create Poll" onclick="createPoll();"/>
    <script>
        function createPoll() {
            var hashtag = $('#hashtag').val();
            var duration = parseInt($('#length').val());
            var length = document.getElementsByName('keyword').length; //get number of keyword boxes added
            var keywords = new Array(length);
            for (var i = 0; i < keywords.length; i++) {
                keywords[i] = {
                    count: 0,
                    pollId: hashtag,
                    id: $('#key' + (i+1)).val()
                };
            }
            var date = new Date();
            date.setMinutes(date.getMinutes() + duration);
            var dateString = dateToDateTime(date);
            console.log(dateString);
            var input = {
                end_Time: dateString,
                results: keywords,
                id: hashtag
            }
            var table = client.getTable('Poll');
            table.insert(input);
            /*client.getTable('Poll').read().done(function (results) {
                console.log(JSON.stringify(results));
            });*/
        }

        //needs to be neatened up
        function dateToDateTime(date){
            var dateString = date.getFullYear()+'-';
            if(date.getMonth()+1 < 10){
                dateString += '0' + (date.getMonth()+1) + '-';
            }
            else{
                dateString += (date.getMonth()+1)+'-';
            }
            if(date.getDate() < 10){
                dateString += '0' + date.getDate()+'T';
            }
            else{
                dateString += date.getDate()+'T';
            }
            if(date.getHours() < 10){
                dateString += '0' + date.getHours()+':';
            }
            else{
                dateString += date.getHours()+':';
            }
            if(date.getMinutes() < 10){
                dateString += '0' + date.getMinutes()+':';
            }
            else{
                dateString += date.getMinutes()+':';
            }
            if(date.getSeconds() < 10){
                dateString += '0' + date.getSeconds()+'Z';
            }
            else{
                dateString += date.getSeconds()+'Z';
            }
            return dateString;
        }
    </script>
</body>
</html>

