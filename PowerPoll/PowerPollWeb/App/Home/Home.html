<!DOCTYPE html>
<html>
<head>
    <title>#PowerPoll</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        
    <script src="../../Scripts/jquery-1.9.1.js" type="text/javascript"></script>

    <link href="../../Content/Office.css" rel="stylesheet" type="text/css" />
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js" type="text/javascript"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.2.5.min.js"></script>
    <script src="/wp-includes/js/addInput.js" language="Javascript" type="text/javascript"></script>
   
        

        <!-- To enable offline debugging using a local reference to Office.js, use:                        -->
        <!-- <script src="../../Scripts/Office/MicrosoftAjax.js" type="text/javascript"></script>  -->
        <!-- <script src="../../Scripts/Office/1.1/office.js" type="text/javascript"></script>  -->

        <link href="../App.css" rel="stylesheet" type="text/css" />
        <script src="../App.js" type="text/javascript"></script>

        <link href="Home.css" rel="stylesheet" type="text/css" />
        <script src="Home.js" type="text/javascript"></script>
        <script>
            var client = new WindowsAzure.MobileServiceClient(
                "https://powerpoll.azure-mobile.net/",
                "zKZEZggVbgQIpzwZuJTtVmHNYRJZtx79"
            );
        </script>
</head>
<body>
    <h1>
        <img src="../../Images/head.png" style="width:100%; height:100%;">
    </h1>
    <div id="key">Poll Hashtag: #<input type="text" placeholder="PollName" id="hashtag" style="border-radius: 3px;" /></div>
    <br />
    <div id="duration">Duration: <input type="number" min="1" max="30" id="length" placeholder="max 30mins" style="border-radius: 3px;" /> (mins)</div>
    <input type="image" src="../../Images/barchartIcon.jpg" width="10%" height="15%" style="position:absolute; top:85%; left:75%;border-style:solid; border-color:#d24726; border-radius:5px;" onclick="createPoll('bar')">
    <input type="image" src="../../Images/piechartIcon.jpg" width="10%" height="15%" style="position:absolute; top:85%; left:90%;border-style:solid; border-color:#d24726; border-radius:5px;" onclick="createPoll('pie')">
    <div id="keywords">
        <br>Keyword 1:  <input type="text" placeholder="Enter Keyword" id="key1" name="keyword" style="border-radius: 3px;" />
        <br>Keyword 2:  <input type="text" placeholder="Enter Keyword" id="key2" name="keyword" style="border-radius: 3px;" />
    </div>
    <input type="button" id="addKeyword" value="+ Keyword" style="border-radius: 5px;" />
    <br>
    <script>
        function createPoll(graphType) {
            var hashtag = $('#hashtag').val();
            var duration = parseInt($('#length').val());
            var length = document.getElementsByName('keyword').length; //get number of keyword boxes added
            var keywords = new Array(length);
            for (var i = 0; i < keywords.length; i++) {
                keywords[i] = {
                    count: 0,
                    pollId: hashtag,
                    id: $('#key' + (i+1)).val()
                };
            }
            var date = new Date();
            date.setMinutes(date.getMinutes() + duration);
            var dateString = dateToDateTime(date);
            var input = {
                end_Time: dateString,
                results: keywords,
                id: hashtag
            }
            var table = client.getTable('Poll');
            table.insert(input);
            //console.log(JSON.stringify(input));
            client.getTable('Poll').read().done(function (results) {
            });
            if (graphType == "bar") {
                window.setTimeout(function () { open("Bar.html?duration=" + duration + "&hash=" + hashtag, "_self")}, 500);
            }
            else if (graphType == "pie") {
                window.setTimeout(function () { open("Pie.html?duration=" + duration + "&hash=" + hashtag, "_self") }, 0);
            }
        }

        //needs to be neatened up
        function dateToDateTime(date){
            var dateString = date.getFullYear()+'-';
            if(date.getMonth()+1 < 10){
                dateString += '0' + (date.getMonth()+1) + '-';
            }
            else{
                dateString += (date.getMonth()+1)+'-';
            }
            if(date.getDate() < 10){
                dateString += '0' + date.getDate()+'T';
            }
            else{
                dateString += date.getDate()+'T';
            }
            if(date.getHours() < 10){
                dateString += '0' + date.getHours()+':';
            }
            else{
                dateString += date.getHours()+':';
            }
            if(date.getMinutes() < 10){
                dateString += '0' + date.getMinutes()+':';
            }
            else{
                dateString += date.getMinutes()+':';
            }
            if(date.getSeconds() < 10){
                dateString += '0' + date.getSeconds()+'Z';
            }
            else{
                dateString += date.getSeconds()+'Z';
            }
            return dateString;
        }
    </script>
</body>
</html>

